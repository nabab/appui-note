// Javascript Document
(() => {
  let bbn_cfg = [{"type": "gallery", "align": "left", "source": [{"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039744-7NE3KCVJUKRPR3OY3SIH/tezenasweb-31_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039744-7NE3KCVJUKRPR3OY3SIH/tezenasweb-31_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382031632-6222A641LGNMZUPAT1UM/tezenasweb-29_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382031632-6222A641LGNMZUPAT1UM/tezenasweb-29_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037734-CLN9BSUG06L2X1961M4X/beijing_15_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037734-CLN9BSUG06L2X1961M4X/beijing_15_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382033714-LM8UKJOPTXNPW19DDODF/beijing_19_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382033714-LM8UKJOPTXNPW19DDODF/beijing_19_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382029624-OH80E9OTDFZ1GDVY55JQ/tezenasweb-26_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382029624-OH80E9OTDFZ1GDVY55JQ/tezenasweb-26_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030080-7WXW29WS3M0OGY3LOEMI/beijing_027_-_copie_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030080-7WXW29WS3M0OGY3LOEMI/beijing_027_-_copie_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030928-3EF02WJR4PBPPCXO6BGF/tezenasweb-9_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030928-3EF02WJR4PBPPCXO6BGF/tezenasweb-9_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382035705-DH6YRG30T7TA6S6QY6NR/beijing_01_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382035705-DH6YRG30T7TA6S6QY6NR/beijing_01_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037637-I5XZJW4QVU2PG2A109HW/beijing_04_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037637-I5XZJW4QVU2PG2A109HW/beijing_04_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039909-LY4G9CDXS8BF5PVIEXTK/beijing_09_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039909-LY4G9CDXS8BF5PVIEXTK/beijing_09_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041802-8S7RTUT67KNYB2TC53MF/beijing_02_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041802-8S7RTUT67KNYB2TC53MF/beijing_02_905.jpg"}, {"src": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041711-5NOGTL28FASPDZ8TPCV3/beijing_03_905.jpg", "href": "https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041711-5NOGTL28FASPDZ8TPCV3/beijing_03_905.jpg"}]}, {"hr": false, "tag": "h2", "type": "title", "align": "left", "content": "Beijing, theatre of the people"}, {"type": "html", "align": "left", "content": "<p>We, in the West, are fascinated by the development of China. For the last half of the twentieth century its borders were effectively closed and, with rare exceptions, the only images that came out of the country were either propaganda or coverage of a tragic news event. Between 2001 and 2005, French photographer, Ambroise Tézenas made several visits to Beijing. As he wandered through the city he began to recognise that its landscape offered an unexpected vision – its spaces almost stage sets in which contemporary Beijing plays out a complex struggle – a city caught between two worlds, an ancient past and a frenzied present. Included are images of the construction of major projects – the Opera House, Grand National Theatre and Olympic Stadium – all part of a massive rebuilding programme.</p>"}, {"type": "line", "align": "left"}, {"type": "space"},{"type": "html", "align": "left", "content": "<p><strong>More information: </strong><br>www.ambroisetezenas.com</p>"}];
  /*
  bbn_cfg = [
    {
        "type": "gallery",
        "align": "left",
        "source": [
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420237758-G7EFQI6OEOR0N5WRSJE4/Christopher+Taylor-+Leishan-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420237758-G7EFQI6OEOR0N5WRSJE4/Christopher+Taylor-+Leishan-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420245073-V6FXUFBA0JBYMTSV2ZGR/Christopher+Taylor-+Biasha+2-+2011++Courtesy+of+OFOTO+Gallery.jpg+_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420245073-V6FXUFBA0JBYMTSV2ZGR/Christopher+Taylor-+Biasha+2-+2011++Courtesy+of+OFOTO+Gallery.jpg+_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420250758-VFTI3DDNO8ASI0Y3DO2V/Christopher+Taylor-+Gaozeng+8-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420250758-VFTI3DDNO8ASI0Y3DO2V/Christopher+Taylor-+Gaozeng+8-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420262567-HZ3RT5C5DCRFI0Z8UCSQ/Christopher+Taylor-+Jialiang+2-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420262567-HZ3RT5C5DCRFI0Z8UCSQ/Christopher+Taylor-+Jialiang+2-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420270221-R70E8U2A3S643QWTV11V/Christopher+Taylor-+Jiaoche+1-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420270221-R70E8U2A3S643QWTV11V/Christopher+Taylor-+Jiaoche+1-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420290960-Y7QNJD4L6IPPKS0A2Z2S/Christopher+Taylor-+Jiaoche+6-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420290960-Y7QNJD4L6IPPKS0A2Z2S/Christopher+Taylor-+Jiaoche+6-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420309512-L8AIV0JDD4S16GYZYOB9/Christopher+Taylor-+Rongjiang+1-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420309512-L8AIV0JDD4S16GYZYOB9/Christopher+Taylor-+Rongjiang+1-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420330315-7LOLFTISWVU625H9NT18/Christopher+Taylor-+Wugong+2-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420330315-7LOLFTISWVU625H9NT18/Christopher+Taylor-+Wugong+2-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            },
            {
                "src": "/content/v1/51e2f86de4b0180cf3be09fe/1376420337140-511T3JNZHKIZ9VATAMUH/Christopher+Taylor-+Xiaodanjiang+1-+2011++Courtesy+of+OFOTO+Gallery_905.jpg",
                "href": "/content/v1/51e2f86de4b0180cf3be09fe/1376420337140-511T3JNZHKIZ9VATAMUH/Christopher+Taylor-+Xiaodanjiang+1-+2011++Courtesy+of+OFOTO+Gallery_905.jpg"
            }
        ]
    },
    {
        "hr": false,
        "tag": "h1",
        "type": "title",
        "align": "left",
        "style": {
            "white-space": "pre-wrap"
        },
        "content": "Archive on Recent Past"
    },
    {
        "type": "html",
        "align": "left",
        "style": {
            "white-space": "pre-wrap"
        },
        "content": "<p>Christopher Taylor (born in 1958 in Skegness, United Kingdom) studied zoology before becoming a self-taught photographer. Fond of travelling, he went in France, Iceland, Japan, India and more importantly in China. His photographic series – most in black and white – emphasize on objects, natural environment, and architecture, which ultimately create sorts of still life ranging from the minuscule to the gigantic, from the insect to aerial views. Archive on Recent Past offers another vision of Guizhou: a province mostly depicted through its marvellous karstic landscapes and its ‘minority’ population whose culture is very peculiar. Christopher Taylor portrays this place in a totally new manner by depicting the micro and the macro features: from the detail of a seal to the side of a mountain. These photographs unfold a present that is deeply embedded into an ancient past, and transform the trivial into conspicuous, the infinitesimal into colossal, the amusing into solemn. An invitation to travel through an atypical topography of Guizhou province.</p>"
    },
    {
        "type": "html",
        "align": "left",
        "style": {
            "white-space": "pre-wrap"
        },
        "content": "<p><strong>More information: </strong><br>Christopher Taylor's works on OFOTO Gallery</p>"
    }
];
  */
  let images = bbn.fn.map([
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039744-7NE3KCVJUKRPR3OY3SIH/tezenasweb-31_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039744-7NE3KCVJUKRPR3OY3SIH/tezenasweb-31_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382031632-6222A641LGNMZUPAT1UM/tezenasweb-29_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382031632-6222A641LGNMZUPAT1UM/tezenasweb-29_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037734-CLN9BSUG06L2X1961M4X/beijing_15_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037734-CLN9BSUG06L2X1961M4X/beijing_15_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382033714-LM8UKJOPTXNPW19DDODF/beijing_19_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382033714-LM8UKJOPTXNPW19DDODF/beijing_19_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382029624-OH80E9OTDFZ1GDVY55JQ/tezenasweb-26_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382029624-OH80E9OTDFZ1GDVY55JQ/tezenasweb-26_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030080-7WXW29WS3M0OGY3LOEMI/beijing_027_-_copie_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030080-7WXW29WS3M0OGY3LOEMI/beijing_027_-_copie_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030928-3EF02WJR4PBPPCXO6BGF/tezenasweb-9_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382030928-3EF02WJR4PBPPCXO6BGF/tezenasweb-9_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382035705-DH6YRG30T7TA6S6QY6NR/beijing_01_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382035705-DH6YRG30T7TA6S6QY6NR/beijing_01_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037637-I5XZJW4QVU2PG2A109HW/beijing_04_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382037637-I5XZJW4QVU2PG2A109HW/beijing_04_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039909-LY4G9CDXS8BF5PVIEXTK/beijing_09_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382039909-LY4G9CDXS8BF5PVIEXTK/beijing_09_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041802-8S7RTUT67KNYB2TC53MF/beijing_02_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041802-8S7RTUT67KNYB2TC53MF/beijing_02_905.jpg'},
    {href:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041711-5NOGTL28FASPDZ8TPCV3/beijing_03_905.jpg',src:'https://images.squarespace-cdn.com/content/v1/51e2f86de4b0180cf3be09fe/1601382041711-5NOGTL28FASPDZ8TPCV3/beijing_03_905.jpg'}
  ], a => {
    a.href = 'https://images.squarespace-cdn.com' + a.href;
    a.src = 'https://images.squarespace-cdn.com' + a.src;
    return a;
  });
  return {
    data(){

      return {
        isMoving: false,
        currentEdited: -1,
        nextEdited: -1,
        images: images,
        cfgs: bbn_cfg,
        galleryCfg: {
          type:'gallery',
          linkURL:'https://images.squarespace-cdn.com',
          align: 'left',
          source: images
        },
        titleCfg: {
          type: 'title',
          align: 'left',
          content: 'Beijing, theatre of the people',
          tag: 'h2'
        },
        textCfg: {
          type: 'text',
          align: 'center',
          content: bbn._("I am a multiline") + `

` + bbn._("well centered text"),
          tag: 'h2'
        },
        html1Cfg: {
          type: 'html',
          align: 'left',
          content: '<p>' + bbn._("We, in the West, are fascinated by the development of China. For the last half of the twentieth century its borders were effectively closed and, with rare exceptions, the only images that came out of the country were either propaganda or coverage of a tragic news event. Between 2001 and 2005, French photographer, Ambroise Tézenas made several visits to Beijing. As he wandered through the city he began to recognise that its landscape offered an unexpected vision – its spaces almost stage sets in which contemporary Beijing plays out a complex struggle – a city caught between two worlds, an ancient past and a frenzied present. Included are images of the construction of major projects – the Opera House, Grand National Theatre and Olympic Stadium – all part of a massive rebuilding programme.") + '</p>'
        },
        html2Cfg: {
          type:'html',
          align: 'left',
          content: '<p><strong>' + bbn._("More information") + ': </strong><br>www.ambroisetezenas.com</p>'
        },
        lineCfg: {
          type: 'line',
          align: 'left'
        },
        types: [
          {
            text: bbn._("Title"),
            value: 'title'
          }, {
            text: bbn._("Text"),
            value: 'text'
          }, {
            text: bbn._("Line"),
            value: 'line'
          }, {
            text: bbn._("Space"),
            value: 'space'
          }, {
            text: bbn._("Rich text (HTML)"),
            value: 'html'
          }, {
            text: bbn._("Image"),
            value: 'image'
          }, {
            text: bbn._("Carousel"),
            value: 'carousel'
          }, {
            text: bbn._("Gallery"),
            value: 'gallery'
          }, {
            text: bbn._("Video"),
            value: 'video'
          }
        ],
        data: {
          type: 'text',
          content: ''
        }
      };
    },
    computed: {
      toolbarSource(){
        let res = [];
        if (this.currentEdited !== -1) {
          res.push({});
          res.push({
            icon: 'nf nf-mdi-chevron_double_up',
            notext: true,
            text: bbn._("Move to start"),
            disabled: this.currentEdited <= 1,
            action: () => {
              this.move('up', true);
            }
          });
          res.push({
            icon: 'nf nf-mdi-chevron_up',
            notext: true,
            text: bbn._("Move up"),
            disabled: !this.currentEdited,
            action: () => {
              this.move('up');
            }
          });
          res.push({
            icon: 'nf nf-mdi-chevron_down',
            notext: true,
            text: bbn._("Move down"),
            disabled: this.currentEdited >= this.cfgs.length - 1,
            action: () => {
              this.move('down');
            }
          });
          res.push({
            icon: 'nf nf-mdi-chevron_double_down',
            notext: true,
            text: bbn._("Move to end"),
            disabled: this.currentEdited >= this.cfgs.length - 2,
            action: () => {
              this.move('down', true);
            }
          });
          res.push({
            icon: 'nf nf-fa-trash',
            notext: true,
            text: bbn._("Delete the block"),
            end: true,
            action: () => {
              this.deleteBlock();
            }
          });
        }
        /*
          <div class="bbn-flex-fill bbn-r bbn-h-100">
            <div class="bbn-iblock bbn-nowrap">
              <div class="bbn-iblock">
                <bbn-button icon="nf nf-fa-check"
                            :notext="true"
                            text="<?= _("Supprimer ce bloc") ?>"/>
              </div>
              <div class="bbn-iblock bbn-toolbar-separator"> </div>
              <div class="bbn-iblock">
                <bbn-button icon="nf nf-fa-trash"
                            :notext="true"
                            text="<?= _("Supprimer ce bloc") ?>"/>
              </div>
            </div>
          </div>
          */
        return res;
      },
      contextSource(){
        return [{
          text: bbn._("Add a block before"),
          action: () => {
            let newBlock = {
              type: 'text',
              content: ''
            };
            this.cfgs.splice(this.currentEdited, 0, newBlock);
          }
        }, {
          text: bbn._("Add a block after"),
          action: () => {
            let newBlock = {
              type: 'text',
              content: ''
            };

            if (this.currentEdited === this.cfgs.length - 1) {
              this.cfgs.push(newBlock);
            }
            else {
              this.cfgs.splice(this.currentEdited + 1, 0, newBlock);
            }
          }
        }];
      },
      isEditorOverlay(){
        if (this.currentEdited === -1) {
          return false;
        }

        return ['html', 'markdown', 'gallery'].includes(this.cfgs[this.currentEdited].type);
      },
      isEditorScrollable(){
        if (this.currentEdited === -1) {
          return false;
        }

        return ['html', 'markdown', 'gallery'].includes(this.cfgs[this.currentEdited].type);
      }
    },
    methods: {
      move(dir, idx) {
        let isUp = dir.toLowerCase() === 'up';
        if (idx === true) {
          bbn.fn.move(this.cfgs, this.currentEdited, isUp ? 0 : this.cfgs.length - 1);
          this.currentEdited = isUp ? 0 : this.cfgs.length - 1;
        }
        else if (idx === undefined) {
          bbn.fn.move(this.cfgs, this.currentEdited, isUp ? this.currentEdited - 1 : this.currentEdited + 1);
          this.currentEdited = isUp ? this.currentEdited - 1 : this.currentEdited + 1;
        }
        else if (this.cfgs[idx]) {
          bbn.fn.move(this.cfgs, this.currentEdited, idx);
          this.currentEdited = idx;
        }
        setTimeout(() => {
          this.getRef('block' + this.currentEdited).selected = true;
          this.getRef('leftPane').getRef('scroll').scrollTo(null, this.getRef('block' + this.currentEdited).$el);
        }, 500)
      }
    },
    mounted(){
      
    },
    watch: {
    	currentEdited(v) {
        if (this.isMoving) {
          return;
        }
        if (v === -1) {
          return;
        }

        if (this.nextEdited === v) {
          this.nextEdited = -1;
          this.getRef('toolbar').updateSlot();
        }
        else {
          this.nextEdited = v;
          this.currentEdited = -1;
          setTimeout(() => {
            this.currentEdited = this.nextEdited;
          }, 100)
        }
      }
	  }
  };
})();
